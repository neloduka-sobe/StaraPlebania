import{r as f}from"./index-BgGHRyL3.js";function y({width:t,height:o}){return t/o}function v(t,o=0){const n=10**o;return Math.round((t+Number.EPSILON)*n)/n}function F(t){return(o,n)=>t(n)-t(o)}class O{constructor(o){this.comparator=o,this.heap=[],this.n=0}greater(o,n){return this.comparator(this.heap[o],this.heap[n])<0}swap(o,n){const e=this.heap[o];this.heap[o]=this.heap[n],this.heap[n]=e}swim(o){let n=o,e=Math.floor(n/2);for(;n>1&&this.greater(e,n);)this.swap(e,n),n=e,e=Math.floor(n/2)}sink(o){let n=o,e=n*2;for(;e<=this.n&&(e<this.n&&this.greater(e,e+1)&&(e+=1),!!this.greater(n,e));)this.swap(n,e),n=e,e=n*2}push(o){this.n+=1,this.heap[this.n]=o,this.swim(this.n)}pop(){if(this.n===0)return;this.swap(1,this.n),this.n-=1;const o=this.heap.pop();return this.sink(1),o}size(){return this.n}}function G(t,o,n){const e=new Map,s=new Set,r=new Map;r.set(o,0);const a=new O(F(c=>c.weight));for(a.push({id:o,weight:0});a.size()>0;){const{id:c,weight:i}=a.pop();if(!s.has(c)){const u=t(c);s.add(c),u.forEach((l,h)=>{const p=i+l,d=e.get(h),m=r.get(h);(m===void 0||m>p&&(m/p>1.005||d!==void 0&&d<c))&&(r.set(h,p),a.push({id:h,weight:p}),e.set(h,c))})}}return r.has(n)?e:void 0}function H(t,o){const n=[];for(let e=o;e!==void 0;e=t.get(e))n.push(e);return n.reverse()}function D(t,o,n){const e=G(t,o,n);return e?H(e,n):void 0}function B({photos:t,targetRowHeight:o,containerWidth:n}){const e=t.reduce((s,r)=>Math.min(y(r),s),Number.MAX_VALUE);return v(n/o/e)+2}function S(t,o,n,e){const s=o-(t.length-1)*n-2*e*t.length,r=t.reduce((a,c)=>a+y(c),0);return s/r}function V(t,o,n,e,s,r,a){const c=t.slice(o,n),i=S(c,e,r,a);return i>0?(i-s)**2*c.length:void 0}function q({photos:t,layoutOptions:o,targetRowHeight:n,limitNodeSearch:e,rowConstraints:s}){return r=>{var a,c;const{containerWidth:i,spacing:u,padding:l}=o,h=new Map;h.set(r,0);const p=(a=s==null?void 0:s.minPhotos)!=null?a:1,d=Math.min(e,(c=s==null?void 0:s.maxPhotos)!=null?c:1/0);for(let m=r+p;m<t.length+1&&!(m-r>d);m+=1){const g=V(t,r,m,i,n,u,l);if(g===void 0)break;h.set(m,g)}return h}}function Q({photos:t,layoutOptions:o}){const{spacing:n,padding:e,containerWidth:s,targetRowHeight:r,rowConstraints:a}=o,c=B({photos:t,containerWidth:s,targetRowHeight:r}),i=q({photos:t,layoutOptions:o,targetRowHeight:r,limitNodeSearch:c,rowConstraints:a}),u=D(i,0,t.length);if(u===void 0)return;const l=[];for(let h=1;h<u.length;h+=1){const p=t.map((m,g)=>({photo:m,index:g})).slice(u[h-1],u[h]),d=S(p.map(({photo:m})=>m),s,n,e);l.push(p.map(({photo:m,index:g},w)=>({photo:m,layout:{height:d,width:d*y(m),index:g,photoIndex:w,photosCount:p.length}})))}return l}function R(...t){return[...t].filter(o=>!!o).join(" ")}function N(t,o,n){const{width:e,photosCount:s}=o,{layout:r,spacing:a,padding:c,containerWidth:i}=n,u=r==="rows"?s:n.columns,l=a*(u-1)+2*c*u;return`calc((${t} - ${l}px) / ${v((i-l)/e,5)})`}function T(t,o){return o.layout!=="rows"?`calc(100% - ${2*o.padding}px)`:N("100%",t,o)}function L(t,o,n){var e,s;return N((s=(e=t.match(/^\s*calc\((.*)\)\s*$/))==null?void 0:e[1])!=null?s:t,o,n)}function U(t,o,n){var e;let s,r;const a=t.srcSet||t.images;return a&&a.length>0&&(s=a.concat(a.find(({width:c})=>c===t.width)?[]:[{src:t.src,width:t.width,height:t.height}]).sort((c,i)=>c.width-i.width).map(c=>`${c.src} ${c.width}w`).join(", ")),(e=n.sizes)!=null&&e.size?r=(n.sizes.sizes||[]).map(({viewport:c,size:i})=>`${c} ${L(i,o,n)}`).concat(L(n.sizes.size,o,n)).join(", "):r=`${Math.ceil(o.width/n.containerWidth*100)}vw`,{srcSet:s,sizes:r}}function $(t){var o,n;const{photo:e,layout:s,layoutOptions:r,imageProps:{style:a,className:c,...i}={},renderPhoto:u}=t,{onClick:l}=r,h={display:"block",boxSizing:"content-box",width:T(s,r),height:"auto",aspectRatio:`${e.width} / ${e.height}`,...r.padding?{padding:`${r.padding}px`}:null,...(r.layout==="columns"||r.layout==="masonry")&&s.photoIndex<s.photosCount-1?{marginBottom:`${r.spacing}px`}:null,...l?{cursor:"pointer"}:null,...a},p=l?w=>{l({event:w,photo:e,index:s.index})}:void 0,d={src:e.src,alt:(o=e.alt)!=null?o:"",title:e.title,onClick:p,style:h,className:R("react-photo-album--photo",c),loading:"lazy",decoding:"async",...U(e,s,r),...i},m=w=>{const{src:x,alt:M,srcSet:C,sizes:b,style:k,...E}=d;return f.createElement("img",{alt:M,...C?{srcSet:C,sizes:b}:null,src:x,style:w!=null&&w.wrapped?{display:"block",width:"100%",height:"100%"}:k,...E})},g=(({display:w,boxSizing:x,width:M,aspectRatio:C,padding:b,marginBottom:k,cursor:E})=>({display:w,boxSizing:x,width:M,aspectRatio:C,padding:b,marginBottom:k,cursor:E}))(h);return f.createElement(f.Fragment,null,(n=u==null?void 0:u({photo:e,layout:s,layoutOptions:r,imageProps:d,renderDefaultPhoto:m,wrapperStyle:g}))!=null?n:m())}function X({rowContainerProps:t,children:o}){return f.createElement("div",{...t},o)}function J(t){const{layoutOptions:o,rowIndex:n,rowsCount:e,renderRowContainer:s,rowContainerProps:{style:r,className:a,...c}={},children:i}=t,u={className:R("react-photo-album--row",a),style:{display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"flex-start",justifyContent:"space-between",...n<e-1?{marginBottom:`${o.spacing}px`}:null,...r},...c};return f.createElement(f.Fragment,null,(s??X)({layoutOptions:o,rowIndex:n,rowsCount:e,rowContainerProps:u,children:i}))}function K(t){const{photos:o,layoutOptions:n,renderPhoto:e,renderRowContainer:s,componentsProps:{imageProps:r,rowContainerProps:a}}=t,c=Q({photos:o,layoutOptions:n});return c?f.createElement(f.Fragment,null,c.map((i,u)=>f.createElement(J,{key:`row-${u}`,layoutOptions:n,rowIndex:u,rowsCount:c.length,renderRowContainer:s,rowContainerProps:a},i.map(({photo:l,layout:h})=>f.createElement($,{key:l.key||l.src,photo:l,layout:h,layoutOptions:n,renderPhoto:e,imageProps:r}))))):null}function Y(t,o,n,e){const s=new Map,r=new Set;r.add(n);for(let a=0;a<o;a+=1){const c=[...r.keys()];r.clear(),c.forEach(i=>{const u=a>0?s.get(i)[a].weight:0;t(i).forEach(({neighbor:l,weight:h})=>{let p=s.get(l);p||(p=[],s.set(l,p));const d=u+h,m=p[a+1];(!m||m.weight>d&&(m.weight/d>1.0001||i<m.node))&&(p[a+1]={node:i,weight:d}),a<o-1&&l!==e&&r.add(l)})})}return s}function Z(t,o,n){const e=[n];for(let s=n,r=o;r>0;r-=1)s=t.get(s)[r].node,e.push(s);return e.reverse()}function tt(t,o,n,e){return Z(Y(t,o,n,e),o,e)}function nt({photos:t,spacing:o,padding:n,targetColumnWidth:e,targetColumnHeight:s}){return r=>{const a=[],c=s*1.5;let i=e/y(t[r])+2*n;for(let u=r+1;u<t.length+1&&(a.push({neighbor:u,weight:(s-i)**2}),!(i>c||u===t.length));u+=1)i+=e/y(t[u])+o+2*n;return a}}function z({path:t,photos:o,containerWidth:n,columnsGaps:e,columnsRatios:s,spacing:r,padding:a}){const c=[],i=s.reduce((u,l)=>u+l,0);for(let u=0;u<t.length-1;u+=1){const l=o.map((d,m)=>({photo:d,index:m})).slice(t[u],t[u+1]),h=s.reduce((d,m,g)=>d+(e[u]-e[g])*m,0),p=(n-(t.length-2)*r-2*(t.length-1)*a-h)*s[u]/i;c.push(l.map(({photo:d,index:m},g)=>({photo:d,layout:{width:p,height:p/y(d),index:m,photoIndex:g,photosCount:l.length}})))}return c}function et({photos:t,layoutOptions:o,targetColumnWidth:n}){const{columns:e,spacing:s,padding:r,containerWidth:a}=o,c=[],i=[];if(t.length<=e){const d=t.length>0?t.reduce((g,w)=>g+y(w),0)/t.length:1;for(let g=0;g<e;g+=1)c[g]=2*r,i[g]=g<t.length?y(t[g]):d;const m=z({path:Array.from({length:e+1}).map((g,w)=>Math.min(w,t.length)),photos:t,columnsRatios:i,columnsGaps:c,containerWidth:a,spacing:s,padding:r});return{columnsGaps:c,columnsRatios:i,columnsModel:m}}const u=(t.reduce((d,m)=>d+n/y(m),0)+s*(t.length-e)+2*r*t.length)/e,l=nt({photos:t,targetColumnWidth:n,targetColumnHeight:u,spacing:s,padding:r}),h=tt(l,e,0,t.length);for(let d=0;d<h.length-1;d+=1){const m=t.slice(h[d],h[d+1]);c[d]=s*(m.length-1)+2*r*m.length,i[d]=1/m.reduce((g,w)=>g+1/y(w),0)}const p=z({path:h,photos:t,columnsRatios:i,columnsGaps:c,containerWidth:a,spacing:s,padding:r});return{columnsGaps:c,columnsRatios:i,columnsModel:p}}function _(t){const{photos:o,layoutOptions:n}=t,{columns:e,spacing:s,padding:r,containerWidth:a}=n,c=(a-s*(e-1)-2*r*e)/e,{columnsGaps:i,columnsRatios:u,columnsModel:l}=et({photos:o,layoutOptions:n,targetColumnWidth:c});return l.findIndex(h=>h.findIndex(({layout:{width:p,height:d}})=>p<0||d<0)>=0)>=0?e>1?_({photos:o,layoutOptions:{...n,columns:e-1}}):void 0:{columnsModel:l,columnsGaps:i,columnsRatios:u}}function ot({photos:t,layoutOptions:o}){return _({photos:t,layoutOptions:o})}function rt({columnContainerProps:t,children:o}){return f.createElement("div",{...t},o)}function st(t){const{layoutOptions:o,columnIndex:n,columnsCount:e,columnsGaps:s,columnsRatios:r}=t,{layout:a,spacing:c,padding:i}=o;if(a==="masonry"||!s||!r)return`calc((100% - ${c*(e-1)}px) / ${e})`;const u=r.reduce((h,p)=>h+p,0),l=r.reduce((h,p,d)=>h+(s[n]-s[d])*p,0);return`calc((100% - ${v((e-1)*c+2*e*i+l,3)}px) * ${v(r[n]/u,5)} + ${2*i}px)`}function A(t){const{layoutOptions:o,renderColumnContainer:n,children:e,columnContainerProps:{style:s,className:r,...a}={},...c}=t,i={className:R("react-photo-album--column",r),style:{display:"flex",flexDirection:"column",flexWrap:"nowrap",alignItems:"flex-start",width:st(t),justifyContent:o.layout==="columns"?"space-between":"flex-start",...s},...a};return f.createElement(f.Fragment,null,(n??rt)({layoutOptions:o,columnContainerProps:i,children:e,...c}))}function ct(t){const{photos:o,layoutOptions:n,renderPhoto:e,renderColumnContainer:s,componentsProps:{imageProps:r,columnContainerProps:a}}=t,c=ot({photos:o,layoutOptions:n});if(!c)return null;const{columnsModel:i,columnsRatios:u,columnsGaps:l}=c;return f.createElement(f.Fragment,null,i.map((h,p)=>f.createElement(A,{key:`column-${p}`,layoutOptions:n,columnIndex:p,columnsCount:i.length,columnsGaps:l,columnsRatios:u,renderColumnContainer:s,columnContainerProps:a},h.map(({photo:d,layout:m})=>f.createElement($,{key:d.key||d.src,photo:d,layout:m,layoutOptions:n,renderPhoto:e,imageProps:r})))))}function j(t){const{photos:o,layoutOptions:n}=t,{columns:e,spacing:s,padding:r,containerWidth:a}=n,c=(a-s*(e-1)-2*r*e)/e;if(c<=0)return e>1?j({...t,layoutOptions:{...n,columns:e-1}}):void 0;const i=[];for(let l=0;l<e;l+=1)i[l]=0;return o.reduce((l,h,p)=>{const d=i.reduce((m,g,w)=>g<i[m]-1?w:m,0);return i[d]=i[d]+c/y(h)+s+2*r,l[d].push({photo:h,index:p}),l},Array.from({length:e}).map(()=>[])).map(l=>l.map(({photo:h,index:p},d)=>({photo:h,layout:{width:c,height:c/y(h),index:p,photoIndex:d,photosCount:l.length}})))}function it(t){const{photos:o,layoutOptions:n,renderPhoto:e,renderColumnContainer:s,componentsProps:{imageProps:r,columnContainerProps:a}}=t,c=j({photos:o,layoutOptions:n});return c?f.createElement(f.Fragment,null,c.map((i,u)=>f.createElement(A,{key:`masonry-column-${u}`,layoutOptions:n,columnsCount:c.length,columnIndex:u,renderColumnContainer:s,columnContainerProps:a},i.map(({photo:l,layout:h})=>f.createElement($,{key:l.key||l.src,photo:l,layout:h,layoutOptions:n,renderPhoto:e,imageProps:r}))))):null}function at({containerProps:t,children:o,containerRef:n}){return f.createElement("div",{ref:n,...t},o)}function ut(t){const{layout:o,renderContainer:n,children:e,containerRef:s,containerProps:{style:r,className:a,...c}={}}=t,i={className:R("react-photo-album",`react-photo-album--${o}`,a),style:{display:"flex",flexWrap:"nowrap",justifyContent:"space-between",flexDirection:o==="rows"?"column":"row",...r},...c};return f.createElement(f.Fragment,null,(n??at)({containerProps:i,containerRef:s,layout:o,children:e}))}function lt(t){const o=f.useRef(t);return(!t||!o.current||t.join()!==o.current.join())&&(o.current=t),o.current}function dt(t,{newContainerWidth:o,newScrollbarWidth:n}){const{containerWidth:e,scrollbarWidth:s}=t;return e!==void 0&&s!==void 0&&o!==void 0&&n!==void 0&&o>e&&o-e<=20&&n<s?{containerWidth:e,scrollbarWidth:n}:e!==o||s!==n?{containerWidth:o,scrollbarWidth:n}:t}function ht(t,o){let n=t==null?void 0:t.clientWidth;if(n!==void 0&&o&&o.length>0){const e=[...o.filter(r=>r>0)].sort((r,a)=>a-r);e.push(Math.floor(e[e.length-1]/2));const s=n;n=e.find((r,a)=>r<=s||a===e.length-1)}return n}function mt(t,o){const[{containerWidth:n},e]=f.useReducer(dt,{containerWidth:o}),s=f.useRef(null),r=f.useRef();return{containerRef:f.useCallback(c=>{var i;(i=r.current)==null||i.disconnect(),r.current=void 0,s.current=c;const u=()=>e({newContainerWidth:ht(s.current,t),newScrollbarWidth:window.innerWidth-document.documentElement.clientWidth});u(),c&&typeof ResizeObserver<"u"&&(r.current=new ResizeObserver(u),r.current.observe(c))},[t]),containerWidth:n}}const pt=Object.freeze([1200,600,300,0]);function W(t,o){return typeof t=="function"?t(o):t}function I(t,o){return typeof t<"u"?W(t,o):void 0}function ft(t,o){const n=pt.findIndex(e=>e<=o);return W(t[n>=0?n:0],o)}function P(t,o,n,e=0){const s=I(t,o);return Math.round(Math.max(s===void 0?ft(n,o):s,e))}function gt({layout:t,onClick:o,containerWidth:n,targetRowHeight:e,rowConstraints:s,columns:r,spacing:a,padding:c,sizes:i}){return{layout:t,onClick:o,containerWidth:n,columns:P(r,n,[5,4,3,2],1),spacing:P(a,n,[20,15,10,5]),padding:P(c,n,[0,0,0,0,0]),targetRowHeight:P(e,n,[u=>u/5,u=>u/4,u=>u/3,u=>u/2]),rowConstraints:I(s,n),sizes:i}}function wt(t,o,n){const{photos:e,componentsProps:s}=t,r=W(s,o)||{};if(n){const{layout:a,spacing:c,padding:i,rowConstraints:u}=n;if(a==="rows"){const{singleRowMaxHeight:l}=u||{};if(l){const h=Math.floor(e.reduce((p,{width:d,height:m})=>p+d/m*l-2*i,i*e.length*2+c*(e.length-1)));h>0&&(r.containerProps=r.containerProps||{},r.containerProps.style={maxWidth:h,...r.containerProps.style})}}}return r}function yt(t,o,n){const{photos:e,layout:s,renderPhoto:r,renderRowContainer:a,renderColumnContainer:c}=t,i={photos:e,renderPhoto:r,componentsProps:o};return s==="rows"?f.createElement(K,{layoutOptions:n,renderRowContainer:a,...i}):s==="columns"?f.createElement(ct,{layoutOptions:n,renderColumnContainer:c,...i}):f.createElement(it,{layoutOptions:n,renderColumnContainer:c,...i})}function Pt(t){const{photos:o,layout:n,renderContainer:e,defaultContainerWidth:s,breakpoints:r}=t,{containerRef:a,containerWidth:c}=mt(lt(r),s);if(!n||!["rows","columns","masonry"].includes(n)||!Array.isArray(o))return null;const i=c?gt({containerWidth:c,...t}):void 0,u=wt(t,c,i);return f.createElement(ut,{layout:n,containerRef:a,renderContainer:e,containerProps:u.containerProps},i&&yt(t,u,i))}export{Pt as PhotoAlbum,Pt as default,ot as unstable_computeColumnsLayout,j as unstable_computeMasonryLayout,Q as unstable_computeRowsLayout};
